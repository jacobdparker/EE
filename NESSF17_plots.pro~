

common widget_environment, img, didx, tidx, mouseread
common eemouse_environment, rasterfile, rasterdir, sjifile, SiIV_EE_map, goodmap
common data, rasterindex,rasterdata,sjiindex,sjidata


 
map_sz= size(siiv_ee_map)
i = image(siiv_ee_map>100<1000,dimensions=[map_sz(1),map_sz(2)],margin=0)




if mouseread.count gt 0 then begin
   ;add a standard box color for comparison with eemovie
   mouseread.color=round(findgen(mouseread.count)/(mouseread.count)*254)+1
     for i=0,mouseread.count-1 do begin
        boxes= plot( [mouseread.x0[i], mouseread.x1[i], $
               mouseread.x1[i], mouseread.x0[i], mouseread.x0[i]],$
              [mouseread.y0[i], mouseread.y0[i], $
               mouseread.y1[i], mouseread.y1[i], mouseread.y0[i]],$
               rgb_table=25,vert_colors=mouseread.color[i],thick=1.5,/overplot,/current)
        event_number = text(mouseread.x1[i],mouseread.y1[i],string(i, format='(I4)'),/current,/overplot,font_color="white",/data,font_size=6)
        ;-mouseread.y0[i])/2+mouseread.y0[i]-1
     endfor
     
  endif

event = 24
eecolors,ee_event=event,/single,event_color=event_color

line = rasterdata(*,mouseread.y0[event]:mouseread.y1[event],mouseread.x0[event]:mouseread.x1[event])
tline = total(line,2)

raster_size= size(rasterdata)
  
wavemin = rasterindex[0].wavemin
wavemax = rasterindex[0].wavemax
wavesz = raster_size[1]
lambda = wavemin + rasterindex[0].cdelt1*findgen(rasterindex[0].naxis1)
   ;wavelength axis, Angstroms
lambda0 = rasterindex.wavelnth  ;central wavelength for Si IV.
c = 3e5 ;speed of light, km/s
velocity = c * (lambda - lambda0)/lambda0 ;velocity axis, km/s

;; for i=0,n_elements(tline(0,*)) do begin
;;    plot,velocity,tline(*,i),xr=[-200,200],yr=[0,max(tline)]
;;    wait,.1
;; end

y=30
for i=0,n_elements(tline(0,*))-1 do begin
   plot,velocity,line(*,y,i),xr=[-200,200],yr=[0,max(line(*,y,*))]
   wait,.1
end





end
